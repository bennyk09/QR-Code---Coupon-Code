<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR Coupon Generated</title>

  <!-- QR Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script> [web:9]

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #222222;
      color: #ffffff;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .app {
      width: 360px;
      max-width: 100%;
    }

    .app-title {
      text-align: center;
      font-weight: 600;
      font-size: 20px;
      margin-bottom: 24px;
    }

    .ticket-card {
      background: #fdfdfd;
      color: #111111;
      border-radius: 24px;
      padding: 32px 24px 24px;
      position: relative;
      overflow: hidden;
    }

    /* Side notches */
    .ticket-card::before,
    .ticket-card::after {
      content: "";
      position: absolute;
      top: 50%;
      width: 36px;
      height: 36px;
      background: #222222;
      border-radius: 50%;
      transform: translateY(-50%);
    }

    .ticket-card::before {
      left: -18px;
    }

    .ticket-card::after {
      right: -18px;
    }

    .ticket-title {
      text-align: center;
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .coupon-code {
      text-align: center;
      font-size: 32px;
      font-weight: 800;
      letter-spacing: 6px;
      margin-bottom: 16px;
    }

    .qr-wrapper {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    #qrBox canvas,
    #qrBox img {
      display: block;
      margin: 0 auto;
    } [web:9]

    .coins-text {
      text-align: center;
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 16px;
    }

    .divider {
      border-top: 1px dashed #cccccc;
      margin: 8px 0 20px;
    }

    .primary-btn {
      display: block;
      margin: 0 auto;
      padding: 10px 28px;
      border-radius: 999px;
      border: none;
      font-size: 16px;
      font-weight: 600;
      background: #222222;
      color: #ffffff;
      cursor: pointer;
    }

    .primary-btn:disabled {
      background: #888888;
      cursor: default;
    }

    .points-section {
      margin-top: 24px;
      background: #fdfdfd;
      color: #111111;
      border-radius: 18px;
      padding: 16px 20px;
      position: relative;
    }

    .points-section::before,
    .points-section::after {
      content: "";
      position: absolute;
      top: 50%;
      width: 28px;
      height: 28px;
      background: #222222;
      border-radius: 50%;
      transform: translateY(-50%);
    }

    .points-section::before {
      left: -14px;
    }

    .points-section::after {
      right: -14px;
    }

    .points-label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 4px;
      opacity: 0.7;
    }

    .points-balance {
      font-size: 20px;
      font-weight: 800;
    }

    #timerText {
      margin-top: 12px;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
      color: #f5f5f5;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="app-title">TrashClassifiers</div>

    <div class="ticket-card">
      <div class="ticket-title">Coupon Points</div>

      <!-- Masked code row -->
      <div id="maskedCode" class="coupon-code">******</div>

      <!-- QR -->
      <div class="qr-wrapper">
        <div id="qrBox"></div>
      </div>

      <!-- Coins text -->
      <div class="coins-text"><span id="coinsValue">15</span> Coins</div>

      <div class="divider"></div>

      <!-- Save / Generate -->
      <button id="generateBtn" class="primary-btn" onclick="generateCoupon()">
        Save
      </button>
    </div>

    <div class="points-section">
      <div class="points-label">My Points Balance</div>
      <div class="points-balance" id="pointsBalance">Balance: 53 Points</div>
    </div>

    <p id="timerText"></p>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-analytics.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js"; [web:6]

    const firebaseConfig = {
      apiKey: "AIzaSyBfi7yD9ezQkmsthyUQvPhe_7SpmLOZ9XY",
      authDomain: "qr-code---coupon-code.firebaseapp.com",
      databaseURL: "https://qr-code---coupon-code-default-rtdb.firebaseio.com",
      projectId: "qr-code---coupon-code",
      storageBucket: "qr-code---coupon-code.firebasestorage.app",
      messagingSenderId: "219599248612",
      appId: "1:219599248612:web:9b6f8d37eca0526f92a0f1",
      measurementId: "G-WL77B912LB"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getDatabase(app);

    let countdown;
    let lastCode = "";

    window.generateCoupon = function () {
      const btn = document.getElementById("generateBtn");
      const maskedCodeEl = document.getElementById("maskedCode");
      const timerEl = document.getElementById("timerText");
      const qrBox = document.getElementById("qrBox");

      btn.disabled = true;

      // Generate 6‑digit code
      const code = Math.floor(100000 + Math.random() * 900000);
      lastCode = code.toString();

      // Show stars only, like the UI
      maskedCodeEl.textContent = "******";

      // Generate QR
      const redirectURL = `https://bennyk09.github.io/QR-Code---Coupon-Code/?code=${code}`;
      qrBox.innerHTML = "";
      new QRCode(qrBox, {
        text: redirectURL,
        width: 160,
        height: 160
      });

      // Save to Firebase
      const timeStamp = Date.now();
      set(ref(db, "couponCodes/" + timeStamp), {
        coupon: code,
        url: redirectURL,
        generatedAt: timeStamp
      });

      // 20‑second timer
      let timeLeft = 20;
      timerEl.textContent = `Code expires in ${timeLeft} seconds`;

      clearInterval(countdown);
      countdown = setInterval(() => {
        timeLeft--;
        if (timeLeft > 0) {
          timerEl.textContent = `Code expires in ${timeLeft} seconds`;
        } else {
          clearInterval(countdown);
          timerEl.textContent = "Code expired";
          qrBox.innerHTML = "";
          maskedCodeEl.textContent = "******";
          btn.disabled = false;
        }
      }, 1000);
    };
  </script>
</body>
</html>
